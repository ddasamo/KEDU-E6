<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>경동초 맞춤형 영어교육 프로그램</title>
    <!-- GitHub Pages cache fix -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo, useRef } = React;

        // 상수 데이터
        const VOCABULARY = [
            { present: "go", past: "went", korean: "가다" },
            { present: "come", past: "came", korean: "오다" },
            { present: "eat", past: "ate", korean: "먹다" },
            { present: "drink", past: "drank", korean: "마시다" },
            { present: "see", past: "saw", korean: "보다" },
            { present: "hear", past: "heard", korean: "듣다" },
            { present: "speak", past: "spoke", korean: "말하다" },
            { present: "write", past: "wrote", korean: "쓰다" },
            { present: "read", past: "read", korean: "읽다" },
            { present: "run", past: "ran", korean: "달리다" },
            { present: "walk", past: "walked", korean: "걷다" },
            { present: "sleep", past: "slept", korean: "자다" },
            { present: "wake", past: "woke", korean: "깨다" },
            { present: "sit", past: "sat", korean: "앉다" },
            { present: "stand", past: "stood", korean: "서다" }
        ];

        const SENTENCE_QUESTIONS = [
            {
                korean: "나는 어제 공원에 갔다.",
                answer: "I went to the park yesterday.",
                scrambled: ["yesterday", "park", "went", "to", "the", "I"]
            },
            {
                korean: "그녀는 아침에 우유를 마셨다.",
                answer: "She drank milk in the morning.",
                scrambled: ["morning", "drank", "milk", "She", "in", "the"]
            },
            {
                korean: "우리는 영화를 봤다.",
                answer: "We saw a movie.",
                scrambled: ["saw", "We", "a", "movie"]
            },
            {
                korean: "그는 책을 읽었다.",
                answer: "He read a book.",
                scrambled: ["read", "He", "book", "a"]
            },
            {
                korean: "나는 친구와 이야기했다.",
                answer: "I spoke with my friend.",
                scrambled: ["spoke", "with", "I", "my", "friend"]
            }
        ];

        // 앱 상태
        const ResultState = { IDLE: 'IDLE', CORRECT: 'CORRECT', INCORRECT: 'INCORRECT' };
        const QuizMode = { PRESENT_TO_PAST: 'PRESENT_TO_PAST', PAST_TO_PRESENT: 'PAST_TO_PRESENT' };
        const AppMode = { START: 'START', WORD_QUIZ: 'WORD_QUIZ', SENTENCE_QUIZ: 'SENTENCE_QUIZ', TEACHER_MENU: 'TEACHER_MENU', CREATE_WORD: 'CREATE_WORD', CREATE_SENTENCE: 'CREATE_SENTENCE' };

        // 유틸리티 함수
        const shuffleArray = (array) => [...array].sort(() => Math.random() - 0.5);
        const getRandomQuizMode = () => Math.random() < 0.5 ? QuizMode.PRESENT_TO_PAST : QuizMode.PAST_TO_PRESENT;

        // 발음 비교 함수
        const compareAndHighlight = (correctAnswer, userTranscript) => {
            const normalize = (text) => text.toLowerCase().replace(/[.,?!]/g, '').trim();

            const normalizedCorrect = normalize(correctAnswer);
            const normalizedUser = normalize(userTranscript);

            if (!normalizedUser) {
                return { score: 0, diff: React.createElement('p', { className: "text-slate-500" }, "아무 말도 감지되지 않았어요.") };
            }

            const correctWords = normalizedCorrect.split(/\s+/);
            const userWords = normalizedUser.split(/\s+/);

            let correctCount = 0;
            const diffElements = userWords.map((userWord, index) => {
                if (index < correctWords.length && userWord === correctWords[index]) {
                    correctCount++;
                    return React.createElement('span', { key: index }, userWord + ' ');
                } else {
                    return React.createElement('span', { 
                        key: index, 
                        className: "text-red-500 font-semibold underline decoration-wavy" 
                    }, userWord + ' ');
                }
            });

            const score = Math.round((correctCount / correctWords.length) * 100);
            
            return { 
                score, 
                diff: React.createElement('div', { className: "p-2 bg-slate-100 rounded-md" }, diffElements) 
            };
        };

        // 아이콘 컴포넌트들
        const CheckIcon = () => React.createElement('svg', {
            className: "h-8 w-8", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor"
        }, React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M5 13l4 4L19 7" }));

        const CrossIcon = ({ className = "" }) => React.createElement('svg', {
            className: `h-6 w-6 ${className}`, fill: "none", viewBox: "0 0 24 24", stroke: "currentColor"
        }, React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M6 18L18 6M6 6l12 12" }));

        const SpeakerIcon = () => React.createElement('svg', {
            className: "h-6 w-6", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor"
        }, React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" }));

        const BackArrowIcon = () => React.createElement('svg', {
            className: "h-6 w-6", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor"
        }, React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M15 19l-7-7 7-7" }));

        const PlusIcon = () => React.createElement('svg', {
            className: "h-6 w-6", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor"
        }, React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M12 4v16m8-8H4" }));

        const TeacherIcon = () => React.createElement('svg', {
            className: "h-6 w-6", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor"
        }, React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" }));

        const MicrophoneIcon = () => React.createElement('svg', {
            className: "h-6 w-6", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: 2
        }, React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", d: "M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" }));

        const StopIcon = () => React.createElement('svg', {
            className: "h-6 w-6", viewBox: "0 0 24 24", fill: "currentColor"
        }, React.createElement('path', { d: "M6 6h12v12H6z" }));

        const SpinnerIcon = () => React.createElement('svg', {
            className: "animate-spin h-5 w-5 text-white", xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24"
        }, [
            React.createElement('circle', { key: "circle", className: "opacity-25", cx: "12", cy: "12", r: "10", stroke: "currentColor", strokeWidth: "4" }),
            React.createElement('path', { key: "path", className: "opacity-75", fill: "currentColor", d: "M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" })
        ]);

        // 시작 화면
        const StartScreen = ({ onSelectMode }) => React.createElement('div', { className: "w-full max-w-xl mx-auto text-center" },
            React.createElement('div', { className: "bg-white rounded-2xl shadow-2xl p-6 md:p-10" }, [
                React.createElement('h1', { key: "title", className: "text-4xl md:text-5xl font-bold text-slate-800 mb-2" }, "English Practice"),
                React.createElement('p', { key: "subtitle", className: "text-slate-600 mt-2 mb-8" }, "Choose an activity to start."),
                React.createElement('div', { key: "buttons", className: "space-y-4" }, [
                    React.createElement('button', {
                        key: "word-quiz",
                        onClick: () => onSelectMode(AppMode.WORD_QUIZ),
                        className: "w-full py-4 px-6 bg-indigo-600 text-white font-bold text-xl rounded-lg shadow-md hover:bg-indigo-700 transition-transform transform hover:scale-105"
                    }, "단어 익히기 (Learn Words)"),
                    React.createElement('button', {
                        key: "sentence-quiz",
                        onClick: () => onSelectMode(AppMode.SENTENCE_QUIZ),
                        className: "w-full py-4 px-6 bg-teal-600 text-white font-bold text-xl rounded-lg shadow-md hover:bg-teal-700 transition-transform transform hover:scale-105"
                    }, "문장 만들기 (Make Sentences)"),
                    React.createElement('button', {
                        key: "teacher-menu",
                        onClick: () => onSelectMode(AppMode.TEACHER_MENU),
                        className: "w-full py-4 px-6 bg-purple-600 text-white font-bold text-xl rounded-lg shadow-md hover:bg-purple-700 transition-transform transform hover:scale-105 flex items-center justify-center gap-2"
                    }, [
                        React.createElement(TeacherIcon, { key: "icon" }),
                        React.createElement('span', { key: "text" }, "교사용 문제 만들기")
                    ])
                ])
            ])
        );

        // 단어 퀴즈 컴포넌트
        const WordQuiz = ({ onBack, customVocabulary }) => {
            const [words, setWords] = useState([]);
            const [currentIndex, setCurrentIndex] = useState(0);
            const [userInput, setUserInput] = useState('');
            const [result, setResult] = useState(ResultState.IDLE);
            const [showHint, setShowHint] = useState(false);
            const [isFinished, setIsFinished] = useState(false);
            const [quizMode, setQuizMode] = useState(getRandomQuizMode());

            useEffect(() => {
                const wordsToUse = customVocabulary || VOCABULARY;
                setWords(shuffleArray(wordsToUse));
                setQuizMode(getRandomQuizMode());
            }, [customVocabulary]);

            const currentWord = useMemo(() => words[currentIndex], [words, currentIndex]);

            const generateHint = useCallback((word) => {
                const length = word.length;
                if (length <= 2) return `${word[0]} _`;
                if (length === 3) return `${word[0]} _ ${word[2]}`;
                return `${word[0]} ${'_ '.repeat(length - 2)}${word[length-1]}`;
            }, []);

            const handleSpeak = (text) => {
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'en-US';
                    utterance.rate = 0.9;
                    window.speechSynthesis.speak(utterance);
                }
            };

            const handleCheckAnswer = (e) => {
                e.preventDefault();
                if (!userInput.trim()) return;
                const correctAnswer = quizMode === QuizMode.PRESENT_TO_PAST ? currentWord.past : currentWord.present;
                const isCorrect = correctAnswer.toLowerCase().includes(userInput.trim().toLowerCase());
                setResult(isCorrect ? ResultState.CORRECT : ResultState.INCORRECT);
                setShowHint(false);
            };

            const handleNextWord = () => {
                if (currentIndex < words.length - 1) {
                    setCurrentIndex(currentIndex + 1);
                } else {
                    setIsFinished(true);
                }
                setUserInput('');
                setResult(ResultState.IDLE);
                setShowHint(false);
                setQuizMode(getRandomQuizMode());
            };

            const handleRestart = () => {
                const wordsToUse = customVocabulary || VOCABULARY;
                setWords(shuffleArray(wordsToUse));
                setCurrentIndex(0);
                setUserInput('');
                setResult(ResultState.IDLE);
                setShowHint(false);
                setIsFinished(false);
                setQuizMode(getRandomQuizMode());
            };

            if (words.length === 0 || !currentWord) {
                return React.createElement('div', { className: "text-xl" }, "Loading...");
            }

            if (isFinished) {
                return React.createElement('div', { className: "text-center p-10 rounded-2xl shadow-2xl bg-white" }, [
                    React.createElement('h1', { key: "title", className: "text-5xl font-bold mb-4" }, "Congratulations!"),
                    React.createElement('p', { key: "subtitle", className: "text-2xl mb-8" }, "You have completed all the words."),
                    React.createElement('button', { key: "restart", onClick: handleRestart, className: "px-8 py-4 bg-yellow-400 text-indigo-800 font-bold rounded-xl shadow-lg hover:bg-yellow-300" }, "Start Over")
                ]);
            }

            const isPresentToPast = quizMode === QuizMode.PRESENT_TO_PAST;
            const questionWord = isPresentToPast ? currentWord.present : currentWord.past;
            const answerWord = isPresentToPast ? currentWord.past : currentWord.present;

            return React.createElement('div', { className: "w-full max-w-xl mx-auto" }, [
                React.createElement('header', { key: "header", className: "text-center mb-8 relative" }, [
                    React.createElement('button', { key: "back", onClick: onBack, className: "absolute left-0 top-1/2 -translate-y-1/2 p-2 rounded-full hover:bg-slate-200" }, React.createElement(BackArrowIcon)),
                    React.createElement('h1', { key: "title", className: "text-4xl md:text-5xl font-bold text-slate-800" }, "Vocabulary Quiz")
                ]),
                React.createElement('div', { key: "content", className: "bg-white rounded-2xl shadow-2xl p-6 md:p-10" }, [
                    React.createElement('div', { key: "progress", className: "mb-8" }, [
                        React.createElement('div', { key: "progress-text", className: "flex justify-between items-center mb-2 text-slate-600" }, [
                            React.createElement('span', { key: "label" }, "Progress"),
                            React.createElement('span', { key: "count" }, `Word ${currentIndex + 1} / ${words.length}`)
                        ]),
                        React.createElement('div', { key: "progress-bar", className: "w-full bg-slate-200 rounded-full h-4" },
                            React.createElement('div', { className: "bg-indigo-500 h-4 rounded-full", style: { width: `${((currentIndex + 1) / words.length) * 100}%` } })
                        )
                    ]),
                    React.createElement('div', { key: "quiz", className: "text-center" }, [
                        React.createElement('p', { key: "question-type", className: "text-lg text-slate-500 mb-2" }, isPresentToPast ? 'Present (현재형)' : 'Past (과거형)'),
                        React.createElement('div', { key: "question-word", className: "bg-slate-100 rounded-lg p-4 mb-4" }, [
                            React.createElement('p', { key: "word", className: "text-5xl font-bold text-indigo-700" }, questionWord),
                            React.createElement('p', { key: "korean", className: "text-2xl text-slate-600 mt-1" }, currentWord.korean)
                        ]),
                        React.createElement('p', { key: "answer-type", className: "text-lg text-slate-500 mb-2" }, isPresentToPast ? 'Past (과거형)' : 'Present (현재형)'),
                        React.createElement('form', { key: "form", onSubmit: handleCheckAnswer }, [
                            React.createElement('input', {
                                key: "input", type: "text", value: userInput, onChange: (e) => setUserInput(e.target.value),
                                placeholder: "Type the answer...", disabled: result === ResultState.CORRECT,
                                className: "w-full p-4 text-2xl text-center border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500", autoFocus: true
                            }),
                            result !== ResultState.CORRECT && React.createElement('button', {
                                key: "submit", type: "submit",
                                className: "w-full mt-4 py-4 bg-indigo-600 text-white font-bold text-xl rounded-lg shadow-md hover:bg-indigo-700"
                            }, "Check Answer")
                        ]),
                        React.createElement('div', { key: "result", className: "mt-6 min-h-[150px]" }, [
                            result === ResultState.CORRECT && React.createElement('div', { key: "correct", className: "text-green-600 bg-green-100 p-4 rounded-lg space-y-4" }, [
                                React.createElement('div', { key: "correct-header", className: "flex items-center justify-center" }, [
                                    React.createElement(CheckIcon, { key: "check" }),
                                    React.createElement('p', { key: "text", className: "font-bold text-2xl ml-2" }, "Correct!")
                                ]),
                                React.createElement('div', { key: "word-info", className: "text-left text-slate-800 space-y-2" }, [
                                    React.createElement('div', { key: "present", className: "flex justify-between items-center bg-white p-3 rounded-lg" }, [
                                        React.createElement('p', { key: "present-text" }, [
                                            React.createElement('span', { key: "label", className: "text-sm text-slate-500" }, "현재형: "),
                                            React.createElement('strong', { key: "word", className: "text-2xl" }, currentWord.present)
                                        ]),
                                        React.createElement('button', { key: "speak", onClick: () => handleSpeak(currentWord.present), className: "p-2 rounded-full hover:bg-slate-200" }, React.createElement(SpeakerIcon))
                                    ]),
                                    React.createElement('div', { key: "past", className: "flex justify-between items-center bg-white p-3 rounded-lg" }, [
                                        React.createElement('p', { key: "past-text" }, [
                                            React.createElement('span', { key: "label", className: "text-sm text-slate-500" }, "과거형: "),
                                            React.createElement('strong', { key: "word", className: "text-2xl" }, currentWord.past)
                                        ]),
                                        React.createElement('button', { key: "speak", onClick: () => handleSpeak(currentWord.past), className: "p-2 rounded-full hover:bg-slate-200" }, React.createElement(SpeakerIcon))
                                    ])
                                ]),
                                React.createElement('button', { key: "next", onClick: handleNextWord, className: "w-full mt-2 py-4 bg-green-600 text-white font-bold text-xl rounded-lg shadow-md hover:bg-green-700" }, "Next Word")
                            ]),
                            result === ResultState.INCORRECT && React.createElement('div', { key: "incorrect", className: "text-red-600 bg-red-100 p-4 rounded-lg" }, [
                                React.createElement(CrossIcon, { key: "cross", className: "mx-auto" }),
                                React.createElement('p', { key: "text", className: "font-bold text-xl mt-1" }, "Try again!"),
                                !showHint && React.createElement('button', { key: "hint-btn", onClick: () => setShowHint(true), className: "mt-2 text-sm text-indigo-600 hover:underline" }, "Show Hint"),
                                showHint && React.createElement('div', { key: "hint", className: "mt-2 text-lg font-mono tracking-widest bg-yellow-100 text-yellow-800 p-2 rounded" }, generateHint(answerWord))
                            ])
                        ])
                    ])
                ])
            ]);
        };

        // 문장 퀴즈 컴포넌트
        const SentenceQuiz = ({ onBack, customSentences }) => {
            const [questions, setQuestions] = useState([]);
            const [currentIndex, setCurrentIndex] = useState(0);
            const [userInput, setUserInput] = useState('');
            const [result, setResult] = useState(ResultState.IDLE);
            const [showHint, setShowHint] = useState(false);
            const [isFinished, setIsFinished] = useState(false);
            
            // 발음 연습 상태
            const [isPracticing, setIsPracticing] = useState(false);
            const [isProcessing, setIsProcessing] = useState(false);
            const [audioURL, setAudioURL] = useState(null);
            const [pronunciationResult, setPronunciationResult] = useState(null);
            const [practiceError, setPracticeError] = useState(null);

            const mediaRecorderRef = useRef(null);
            const audioChunksRef = useRef([]);
            const recognitionRef = useRef(null);

            useEffect(() => {
                const questionsToUse = customSentences || SENTENCE_QUESTIONS;
                setQuestions(shuffleArray(questionsToUse));
            }, [customSentences]);

            useEffect(() => {
                return () => {
                    if (audioURL) URL.revokeObjectURL(audioURL);
                    if (recognitionRef.current) recognitionRef.current.abort();
                    if (mediaRecorderRef.current && mediaRecorderRef.current.state === 'recording') mediaRecorderRef.current.stop();
                };
            }, [audioURL]);

            const currentQuestion = useMemo(() => questions[currentIndex], [questions, currentIndex]);
            const normalizeAnswer = (str) => str.toLowerCase().replace(/[.,?]/g, '').replace(/\s+/g, ' ').trim();

            const resetPracticeState = () => {
                setIsPracticing(false);
                setIsProcessing(false);
                setAudioURL(null);
                setPronunciationResult(null);
                setPracticeError(null);
                if (mediaRecorderRef.current && mediaRecorderRef.current.state === "recording") {
                    mediaRecorderRef.current.stop();
                }
                if (recognitionRef.current) {
                    recognitionRef.current.abort();
                }
            };

            const handleStartPractice = (correctAnswer) => {
                resetPracticeState();

                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                if (!SpeechRecognition) {
                    setPracticeError("음성 인식이 지원되지 않는 브라우저입니다.");
                    return;
                }
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    setPracticeError("녹음 기능이 지원되지 않는 브라우저입니다.");
                    return;
                }

                navigator.mediaDevices.getUserMedia({ audio: true })
                    .then(stream => {
                        mediaRecorderRef.current = new MediaRecorder(stream);
                        audioChunksRef.current = [];
                        mediaRecorderRef.current.ondataavailable = (event) => audioChunksRef.current.push(event.data);
                        mediaRecorderRef.current.onstop = () => {
                            const audioBlob = new Blob(audioChunksRef.current, { type: 'audio/wav' });
                            setAudioURL(URL.createObjectURL(audioBlob));
                            stream.getTracks().forEach(track => track.stop());
                        };
                        mediaRecorderRef.current.start();
                        
                        recognitionRef.current = new SpeechRecognition();
                        recognitionRef.current.lang = 'en-US';
                        recognitionRef.current.interimResults = false;
                        recognitionRef.current.continuous = false;

                        recognitionRef.current.onresult = (event) => {
                            const transcript = event.results[event.results.length - 1][0].transcript;
                            const result = compareAndHighlight(correctAnswer, transcript);
                            setPronunciationResult({ ...result, transcript });
                        };
                        recognitionRef.current.onerror = (event) => {
                            if (event.error === 'no-speech') {
                                setPracticeError("음성이 감지되지 않았습니다. 다시 시도해주세요.");
                            } else {
                                setPracticeError(`음성 인식 오류: ${event.error}`);
                            }
                        };
                        recognitionRef.current.onend = () => {
                            setIsProcessing(false);
                            setIsPracticing(false);
                            if (mediaRecorderRef.current?.state === 'recording') {
                                mediaRecorderRef.current.stop();
                            }
                        };
                        
                        recognitionRef.current.start();
                        setIsPracticing(true);
                    })
                    .catch(err => {
                        console.error("Mic access error:", err);
                        setPracticeError("마이크에 접근할 수 없습니다. 권한을 확인해주세요.");
                    });
            };

            const handleStopPractice = () => {
                if (mediaRecorderRef.current && mediaRecorderRef.current.state === 'recording') {
                    mediaRecorderRef.current.stop();
                }
                if (recognitionRef.current) {
                    recognitionRef.current.stop();
                }
                setIsPracticing(false);
                setIsProcessing(true);
            };

            const handleCheckAnswer = (e) => {
                e.preventDefault();
                if (!userInput.trim()) return;
                const isCorrect = normalizeAnswer(userInput) === normalizeAnswer(currentQuestion.answer);
                setResult(isCorrect ? ResultState.CORRECT : ResultState.INCORRECT);
                setShowHint(false);
            };

            const handleNextQuestion = () => {
                if (currentIndex < questions.length - 1) {
                    setCurrentIndex(currentIndex + 1);
                } else {
                    setIsFinished(true);
                }
                setUserInput('');
                setResult(ResultState.IDLE);
                setShowHint(false);
                resetPracticeState();
            };

            const handleRestart = () => {
                const questionsToUse = customSentences || SENTENCE_QUESTIONS;
                setQuestions(shuffleArray(questionsToUse));
                setCurrentIndex(0);
                setUserInput('');
                setResult(ResultState.IDLE);
                setShowHint(false);
                setIsFinished(false);
                resetPracticeState();
            };

            const generateHint = useCallback(() => {
                return currentQuestion ? `Sentence starts with "${currentQuestion.answer.split(' ')[0]}".` : '';
            }, [currentQuestion]);

            if (questions.length === 0 || !currentQuestion) {
                return React.createElement('div', { className: "text-xl" }, "Loading...");
            }

            if (isFinished) {
                return React.createElement('div', { className: "text-center p-10 rounded-2xl shadow-2xl bg-white" }, [
                    React.createElement('h1', { key: "title", className: "text-5xl font-bold mb-4" }, "Well Done!"),
                    React.createElement('p', { key: "subtitle", className: "text-2xl mb-8" }, "You have completed all the sentences."),
                    React.createElement('button', { key: "restart", onClick: handleRestart, className: "px-8 py-4 bg-yellow-400 text-indigo-800 font-bold rounded-xl shadow-lg hover:bg-yellow-300" }, "Start Over")
                ]);
            }

            return React.createElement('div', { className: "w-full max-w-xl mx-auto" }, [
                React.createElement('header', { key: "header", className: "text-center mb-8 relative" }, [
                    React.createElement('button', { key: "back", onClick: onBack, className: "absolute left-0 top-1/2 -translate-y-1/2 p-2 rounded-full hover:bg-slate-200" }, React.createElement(BackArrowIcon)),
                    React.createElement('h1', { key: "title", className: "text-4xl md:text-5xl font-bold text-slate-800" }, "Sentence Practice")
                ]),
                React.createElement('div', { key: "content", className: "bg-white rounded-2xl shadow-2xl p-6 md:p-10" }, [
                    React.createElement('div', { key: "progress", className: "mb-8" }, [
                        React.createElement('div', { key: "progress-text", className: "flex justify-between items-center mb-2 text-slate-600" }, [
                            React.createElement('span', { key: "label" }, "Progress"),
                            React.createElement('span', { key: "count" }, `Question ${currentIndex + 1} / ${questions.length}`)
                        ]),
                        React.createElement('div', { key: "progress-bar", className: "w-full bg-slate-200 rounded-full h-4" },
                            React.createElement('div', { className: "bg-teal-500 h-4 rounded-full", style: { width: `${((currentIndex + 1) / questions.length) * 100}%` } })
                        )
                    ]),
                    React.createElement('div', { key: "quiz", className: "text-center" }, [
                        React.createElement('p', { key: "korean-label", className: "text-lg text-slate-500 mb-2" }, "Korean"),
                        React.createElement('div', { key: "korean-text", className: "bg-slate-100 rounded-lg p-4 mb-4" },
                            React.createElement('p', { className: "text-3xl font-bold text-slate-700" }, currentQuestion.korean)
                        ),
                        React.createElement('p', { key: "scrambled-label", className: "text-lg text-slate-500 mb-2" }, "Unscramble the words:"),
                        React.createElement('p', { key: "scrambled-words", className: "text-xl font-mono tracking-wide text-teal-700 mb-4 bg-teal-50 p-3 rounded-md" }, currentQuestion.scrambled.join(' / ')),
                        React.createElement('form', { key: "form", onSubmit: handleCheckAnswer }, [
                            React.createElement('input', {
                                key: "input", type: "text", value: userInput, onChange: (e) => setUserInput(e.target.value),
                                placeholder: "Type the correct sentence...", disabled: result === ResultState.CORRECT,
                                className: "w-full p-4 text-xl text-center border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-teal-500", autoFocus: true
                            }),
                            result !== ResultState.CORRECT && React.createElement('button', {
                                key: "submit", type: "submit",
                                className: "w-full mt-4 py-4 bg-teal-600 text-white font-bold text-xl rounded-lg shadow-md hover:bg-teal-700"
                            }, "Check Answer")
                        ]),
                        React.createElement('div', { key: "result", className: "mt-6 min-h-[120px]" }, [
                            result === ResultState.CORRECT && React.createElement('div', { key: "correct", className: "text-green-600 bg-green-100 p-4 rounded-lg space-y-4" }, [
                                React.createElement('div', { key: "correct-header", className: "flex items-center justify-center" }, [
                                    React.createElement(CheckIcon, { key: "check" }),
                                    React.createElement('p', { key: "text", className: "font-bold text-2xl ml-2" }, "Correct!")
                                ]),
                                React.createElement('p', { key: "answer", className: "text-xl text-slate-800" }, currentQuestion.answer),
                                React.createElement('div', { key: "pronunciation-section", className: "w-full pt-4 border-t-2 border-green-200 space-y-3" }, [
                                    React.createElement('h3', { key: "title", className: "text-lg font-bold text-slate-700" }, "발음 정확도 확인하기"),
                                    practiceError && React.createElement('p', { key: "error", className: "text-red-500 text-sm" }, practiceError),
                                    pronunciationResult && React.createElement('div', { key: "result", className: "text-left text-slate-800 space-y-2 p-3 bg-white rounded-lg" }, [
                                        React.createElement('p', { key: "score", className: "text-2xl font-bold" }, [
                                            "정확도: ",
                                            React.createElement('span', { key: "percentage", className: "text-purple-600" }, `${pronunciationResult.score}%`)
                                        ]),
                                        React.createElement('p', { key: "label", className: "text-sm text-slate-500" }, "내가 읽은 문장:"),
                                        pronunciationResult.diff
                                    ]),
                                    audioURL && React.createElement('audio', { key: "audio", controls: true, src: audioURL, className: "w-full" }),
                                    React.createElement('button', {
                                        key: "practice-btn",
                                        onClick: () => isPracticing ? handleStopPractice() : handleStartPractice(currentQuestion.answer),
                                        disabled: isProcessing,
                                        className: `w-full flex items-center justify-center py-3 text-white font-bold rounded-lg shadow-md transition-all ${isPracticing ? 'bg-red-500' : 'bg-purple-600 hover:bg-purple-700'} ${isProcessing ? 'bg-slate-400' : ''}`
                                    }, [
                                        isPracticing ? React.createElement(StopIcon, { key: "icon" }) : 
                                        isProcessing ? React.createElement(SpinnerIcon, { key: "icon" }) : 
                                        React.createElement(MicrophoneIcon, { key: "icon" }),
                                        React.createElement('span', { key: "text", className: "ml-2" }, 
                                            isPracticing ? "녹음 중지" : 
                                            isProcessing ? "분석 중..." : 
                                            "따라 읽기"
                                        )
                                    ])
                                ]),
                                React.createElement('button', { key: "next", onClick: handleNextQuestion, className: "w-full mt-2 py-4 bg-green-600 text-white font-bold text-xl rounded-lg shadow-md hover:bg-green-700" }, "Next Question")
                            ]),
                            result === ResultState.INCORRECT && React.createElement('div', { key: "incorrect", className: "text-red-600 bg-red-100 p-4 rounded-lg" }, [
                                React.createElement(CrossIcon, { key: "cross", className: "mx-auto" }),
                                React.createElement('p', { key: "text", className: "font-bold text-xl mt-1" }, "Try again!"),
                                !showHint && React.createElement('button', { key: "hint-btn", onClick: () => setShowHint(true), className: "mt-2 text-sm text-indigo-600 hover:underline" }, "Show Hint"),
                                showHint && React.createElement('div', { key: "hint", className: "mt-2 text-lg font-mono bg-yellow-100 text-yellow-800 p-2 rounded" }, generateHint())
                            ])
                        ])
                    ])
                ])
            ]);
        };

        // 교사용 메뉴 컴포넌트
        const TeacherMenu = ({ onBack, onSelectMode, setCustomVocabulary, setCustomSentences }) => {
            return React.createElement('div', { className: "w-full max-w-xl mx-auto" }, [
                React.createElement('header', { key: "header", className: "text-center mb-8 relative" }, [
                    React.createElement('button', {
                        key: "back",
                        onClick: onBack,
                        className: "absolute left-0 top-1/2 -translate-y-1/2 p-2 rounded-full hover:bg-slate-200"
                    }, React.createElement(BackArrowIcon)),
                    React.createElement('h1', {
                        key: "title",
                        className: "text-4xl md:text-5xl font-bold text-slate-800"
                    }, "교사용 문제 만들기")
                ]),
                React.createElement('div', { key: "content", className: "bg-white rounded-2xl shadow-2xl p-6 md:p-10" }, [
                    React.createElement('div', { key: "buttons", className: "space-y-4" }, [
                        React.createElement('button', {
                            key: "create-word",
                            onClick: () => onSelectMode(AppMode.CREATE_WORD),
                            className: "w-full py-4 px-6 bg-indigo-600 text-white font-bold text-xl rounded-lg shadow-md hover:bg-indigo-700 transition-transform transform hover:scale-105 flex items-center justify-center gap-2"
                        }, [
                            React.createElement(PlusIcon, { key: "icon" }),
                            React.createElement('span', { key: "text" }, "단어 문제 만들기")
                        ]),
                        React.createElement('button', {
                            key: "create-sentence",
                            onClick: () => onSelectMode(AppMode.CREATE_SENTENCE),
                            className: "w-full py-4 px-6 bg-teal-600 text-white font-bold text-xl rounded-lg shadow-md hover:bg-teal-700 transition-transform transform hover:scale-105 flex items-center justify-center gap-2"
                        }, [
                            React.createElement(PlusIcon, { key: "icon" }),
                            React.createElement('span', { key: "text" }, "문장 문제 만들기")
                        ])
                    ])
                ])
            ]);
        };

        // 단어 문제 만들기 컴포넌트
        const CreateWordProblems = ({ onBack, setCustomVocabulary }) => {
            const [inputText, setInputText] = useState('');
            const [words, setWords] = useState([]);

            const handleAddWord = () => {
                const lines = inputText.split('\n').filter(line => line.trim());
                const newWords = [];
                
                lines.forEach(line => {
                    const parts = line.split(',').map(part => part.trim());
                    if (parts.length >= 3) {
                        newWords.push({
                            present: parts[0],
                            past: parts[1],
                            korean: parts[2]
                        });
                    }
                });
                
                if (newWords.length > 0) {
                    setWords(newWords);
                    setCustomVocabulary(newWords);
                    alert(`${newWords.length}개의 단어가 추가되었습니다!`);
                    setInputText('');
                }
            };

            return React.createElement('div', { className: "w-full max-w-2xl mx-auto" }, [
                React.createElement('header', { key: "header", className: "text-center mb-8 relative" }, [
                    React.createElement('button', {
                        key: "back",
                        onClick: onBack,
                        className: "absolute left-0 top-1/2 -translate-y-1/2 p-2 rounded-full hover:bg-slate-200"
                    }, React.createElement(BackArrowIcon)),
                    React.createElement('h1', {
                        key: "title",
                        className: "text-3xl md:text-4xl font-bold text-slate-800"
                    }, "단어 문제 만들기")
                ]),
                React.createElement('div', { key: "content", className: "bg-white rounded-2xl shadow-2xl p-6 md:p-10" }, [
                    React.createElement('div', { key: "instructions", className: "mb-6" }, [
                        React.createElement('h2', { key: "title", className: "text-xl font-bold text-slate-700 mb-3" }, "사용법:"),
                        React.createElement('p', { key: "desc", className: "text-slate-600 mb-2" }, "각 줄에 '현재형,과거형,한국어' 형식으로 입력하세요."),
                        React.createElement('p', { key: "example", className: "text-slate-500 text-sm" }, "예: go,went,가다")
                    ]),
                    React.createElement('textarea', {
                        key: "input",
                        value: inputText,
                        onChange: (e) => setInputText(e.target.value),
                        placeholder: "go,went,가다\ncome,came,오다\neat,ate,먹다",
                        className: "w-full p-4 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-none",
                        rows: 8
                    }),
                    React.createElement('button', {
                        key: "submit",
                        onClick: handleAddWord,
                        className: "w-full mt-4 py-3 bg-indigo-600 text-white font-bold text-lg rounded-lg shadow-md hover:bg-indigo-700"
                    }, "단어 추가하기"),
                    words.length > 0 && React.createElement('div', { key: "preview", className: "mt-6 p-4 bg-green-50 rounded-lg" }, [
                        React.createElement('h3', { key: "title", className: "font-bold text-green-800 mb-2" }, "추가된 단어들:"),
                        React.createElement('div', { key: "words", className: "space-y-1" },
                            words.map((word, index) => 
                                React.createElement('p', { key: index, className: "text-green-700" }, 
                                    `${word.present} → ${word.past} (${word.korean})`
                                )
                            )
                        )
                    ])
                ])
            ]);
        };

        // 문장 문제 만들기 컴포넌트
        const CreateSentenceProblems = ({ onBack, setCustomSentences }) => {
            const [inputText, setInputText] = useState('');
            const [sentences, setSentences] = useState([]);

            const handleAddSentence = () => {
                const lines = inputText.split('\n').filter(line => line.trim());
                const newSentences = [];
                
                lines.forEach(line => {
                    const parts = line.split('|').map(part => part.trim());
                    if (parts.length >= 2) {
                        const answer = parts[1];
                        const words = answer.split(' ').filter(word => word.trim());
                        const scrambled = shuffleArray(words);
                        
                        newSentences.push({
                            korean: parts[0],
                            answer: answer,
                            scrambled: scrambled
                        });
                    }
                });
                
                if (newSentences.length > 0) {
                    setSentences(newSentences);
                    setCustomSentences(newSentences);
                    alert(`${newSentences.length}개의 문장이 추가되었습니다!`);
                    setInputText('');
                }
            };

            return React.createElement('div', { className: "w-full max-w-2xl mx-auto" }, [
                React.createElement('header', { key: "header", className: "text-center mb-8 relative" }, [
                    React.createElement('button', {
                        key: "back",
                        onClick: onBack,
                        className: "absolute left-0 top-1/2 -translate-y-1/2 p-2 rounded-full hover:bg-slate-200"
                    }, React.createElement(BackArrowIcon)),
                    React.createElement('h1', {
                        key: "title",
                        className: "text-3xl md:text-4xl font-bold text-slate-800"
                    }, "문장 문제 만들기")
                ]),
                React.createElement('div', { key: "content", className: "bg-white rounded-2xl shadow-2xl p-6 md:p-10" }, [
                    React.createElement('div', { key: "instructions", className: "mb-6" }, [
                        React.createElement('h2', { key: "title", className: "text-xl font-bold text-slate-700 mb-3" }, "사용법:"),
                        React.createElement('p', { key: "desc", className: "text-slate-600 mb-2" }, "각 줄에 '한국어문장|영어문장' 형식으로 입력하세요."),
                        React.createElement('p', { key: "example", className: "text-slate-500 text-sm" }, "예: 나는 학교에 간다|I go to school")
                    ]),
                    React.createElement('textarea', {
                        key: "input",
                        value: inputText,
                        onChange: (e) => setInputText(e.target.value),
                        placeholder: "나는 학교에 간다|I go to school\n그는 책을 읽는다|He reads a book\n우리는 공원에서 논다|We play in the park",
                        className: "w-full p-4 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent resize-none",
                        rows: 8
                    }),
                    React.createElement('button', {
                        key: "submit",
                        onClick: handleAddSentence,
                        className: "w-full mt-4 py-3 bg-teal-600 text-white font-bold text-lg rounded-lg shadow-md hover:bg-teal-700"
                    }, "문장 추가하기"),
                    sentences.length > 0 && React.createElement('div', { key: "preview", className: "mt-6 p-4 bg-green-50 rounded-lg" }, [
                        React.createElement('h3', { key: "title", className: "font-bold text-green-800 mb-2" }, "추가된 문장들:"),
                        React.createElement('div', { key: "sentences", className: "space-y-2" },
                            sentences.map((sentence, index) => 
                                React.createElement('div', { key: index, className: "text-green-700" }, [
                                    React.createElement('p', { key: "korean", className: "font-semibold" }, sentence.korean),
                                    React.createElement('p', { key: "english", className: "text-sm" }, sentence.answer)
                                ])
                            )
                        )
                    ])
                ])
            ]);
        };

        // 메인 앱 컴포넌트
        const App = () => {
            const [appMode, setAppMode] = useState(AppMode.START);
            const [customVocabulary, setCustomVocabulary] = useState(null);
            const [customSentences, setCustomSentences] = useState(null);

            const renderContent = () => {
                switch (appMode) {
                    case AppMode.WORD_QUIZ:
                        return React.createElement(WordQuiz, { 
                            onBack: () => setAppMode(AppMode.START),
                            customVocabulary: customVocabulary
                        });
                    case AppMode.SENTENCE_QUIZ:
                        return React.createElement(SentenceQuiz, { 
                            onBack: () => setAppMode(AppMode.START),
                            customSentences: customSentences
                        });
                    case AppMode.TEACHER_MENU:
                        return React.createElement(TeacherMenu, { 
                            onBack: () => setAppMode(AppMode.START),
                            onSelectMode: setAppMode,
                            setCustomVocabulary: setCustomVocabulary,
                            setCustomSentences: setCustomSentences
                        });
                    case AppMode.CREATE_WORD:
                        return React.createElement(CreateWordProblems, { 
                            onBack: () => setAppMode(AppMode.TEACHER_MENU),
                            setCustomVocabulary: setCustomVocabulary
                        });
                    case AppMode.CREATE_SENTENCE:
                        return React.createElement(CreateSentenceProblems, { 
                            onBack: () => setAppMode(AppMode.TEACHER_MENU),
                            setCustomSentences: setCustomSentences
                        });
                    case AppMode.START:
                    default:
                        return React.createElement(StartScreen, { onSelectMode: setAppMode });
                }
            };

            return React.createElement('div', {
                className: "min-h-screen bg-gradient-to-br from-blue-100 to-indigo-200 flex flex-col items-center justify-center p-4 font-sans"
            }, [
                React.createElement('img', { 
                    key: "header-image", 
                    src: "https://i.ibb.co/hRnPTxt9/1.png", 
                    alt: "경동초등학교 로고",
                    className: "w-48 h-48 md:w-56 md:h-56 object-contain mb-6"
                }),
                React.createElement('h1', { key: "main-title", className: "text-2xl font-bold text-slate-700 mb-6" }, "경동초 맞춤형 영어교육 프로그램"),
                React.createElement('div', { key: "content" }, renderContent())
            ]);
        };

        // 앱 렌더링
        ReactDOM.render(React.createElement(App), document.getElementById('root'));
    </script>
</body>
</html>